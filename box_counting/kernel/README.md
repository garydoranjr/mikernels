Original source code obtained from Qingping Tao.
